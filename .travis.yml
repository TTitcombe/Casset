#sudo: required
dist: xenial
language: cpp

jobs:
  include:
    - stage: "Static Analysis"                # Run different code checking in parallel
      name: "cppcheck"
      compiler: gcc
      addons:
       apt:
        sources:
         - ubuntu-toolchain-r-test
        packages:
         - g++-7
         - cppcheck
      env: COMPILER=g++-7
      script:
       - sudo apt install python3-pip python3-setuptools xutils-dev
       - sudo pip3 install conan
       - conan user
       - conan remote add zimmerk https://api.bintray.com/conan/zimmerk/conan
       - conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan
       - conan remote add vthiery https://api.bintray.com/conan/vthiery/conan-packages
       - conan remote add cli11 https://api.bintray.com/conan/cliutils/CLI11
       - mkdir -p ~/.conan/profiles
       - cp travis/default ~/.conan/profiles/default
       - mkdir build
       - cd build
       - cmake -DCMAKE_CXX_COMPILER=$COMPILER -DCMAKE_BUILD_TYPE=Debug ..
       - cppcheck --quiet --force --error-exitcode=1 .
    - name: "clang format"
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-xenial
          packages:
            - g++-7
            - clang-format-5.0
      env: COMPILER=g++-7
      script:
        - sudo apt install python3-pip python3-setuptools xutils-dev
        - sudo pip3 install conan
        - conan user
        - conan remote add zimmerk https://api.bintray.com/conan/zimmerk/conan
        - conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan
        - conan remote add vthiery https://api.bintray.com/conan/vthiery/conan-packages
        - conan remote add cli11 https://api.bintray.com/conan/cliutils/CLI11
        - mkdir -p ~/.conan/profiles
        - cp travis/default ~/.conan/profiles/default
        - mkdir build
        - cd build
        - cmake -DCMAKE_CXX_COMPILER=$COMPILER -DCMAKE_BUILD_TYPE=Debug ..
        - "../travis/clang_format.sh"
    - stage: "Test"                   # Run different OS tests in parallel
      name: "Ubuntu Unit Test"
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-7
            - cppcheck
      env: COMPILER=g++-7
      script:
        - sudo apt install python3-pip python3-setuptools xutils-dev
        - sudo pip3 install conan
        - conan user
        - conan remote add zimmerk https://api.bintray.com/conan/zimmerk/conan
        - conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan
        - conan remote add vthiery https://api.bintray.com/conan/vthiery/conan-packages
        - conan remote add cli11 https://api.bintray.com/conan/cliutils/CLI11
        - mkdir -p ~/.conan/profiles
        - cp travis/default ~/.conan/profiles/default
        - mkdir build
        - cd build
        - cmake -DCMAKE_CXX_COMPILER=$COMPILER -DCMAKE_BUILD_TYPE=Debug .. && make
        - ./bin/UnitTests